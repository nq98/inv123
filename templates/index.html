<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Invoice Extraction System</title>
    <link rel="stylesheet" href="/static/style.css?v=10">
</head>
<body>
    <!-- ==================== STEP 1: VENDOR SELECTION MODAL (REQUIRED) ==================== -->
    <div id="vendorSelectionModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <h2>üîç Step 1: Vendor Selection (Required)</h2>
            <div class="modal-body">
                <div id="invoiceVendorInfo" class="alert-info"></div>
                
                <div class="vendor-search-section">
                    <h3>Option 1: Select Existing Vendor</h3>
                    <input type="text" id="vendorSearchBox" placeholder="Type vendor name to search..." 
                           class="form-input" oninput="searchVendorsForSelection(this.value)">
                    <div id="vendorSearchResultsList" class="vendor-results"></div>
                </div>
                
                <div class="or-divider">‚îÅ‚îÅ‚îÅ OR ‚îÅ‚îÅ‚îÅ</div>
                
                <div class="create-vendor-section">
                    <h3>Option 2: Create New Vendor</h3>
                    <button onclick="showVendorCreationForm()" class="btn btn-secondary">
                        ‚ûï Create New Vendor
                    </button>
                    <div id="createVendorFormSection" style="display: none; margin-top: 1rem;">
                        <input type="text" id="newVendorName" placeholder="Vendor Name *" class="form-input" required>
                        <input type="email" id="newVendorEmail" placeholder="Email (optional)" class="form-input">
                        <input type="text" id="newVendorPhone" placeholder="Phone (optional)" class="form-input">
                        <input type="text" id="newVendorTaxId" placeholder="Tax ID (optional)" class="form-input">
                        <textarea id="newVendorAddress" placeholder="Address (optional)" class="form-input"></textarea>
                        <button onclick="createNewVendorAndMatch()" class="btn btn-primary">
                            Create & Select Vendor
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== STEP 2: NETSUITE CHECK MODAL ==================== -->
    <div id="netsuiteCheckModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <h2>üîÑ Step 2: NetSuite Vendor Check</h2>
            <div class="modal-body">
                <div id="netsuiteCheckStatus"></div>
            </div>
        </div>
    </div>

    <!-- ==================== STEP 3: INVOICE CREATION MODAL ==================== -->
    <div id="invoiceCreationModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <h2>üìã Step 3: Create Vendor Bill in NetSuite</h2>
            <div class="modal-body">
                <div id="invoiceCreationContent"></div>
            </div>
        </div>
    </div>

    <!-- ==================== WORKFLOW MODAL (for Create Bill button) ==================== -->
    <div id="workflowModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeWorkflowModal()">&times;</span>
            <h2>üìã NetSuite Bill Creation Workflow</h2>
            
            <div class="workflow-steps">
                <div class="workflow-step">
                    <span id="match-status">‚è≥</span> Vendor Matching
                    <div id="match-message"></div>
                </div>
                <div class="workflow-step">
                    <span id="netsuite-check-status">‚è≥</span> NetSuite Vendor Check
                    <div id="netsuite-check-message"></div>
                </div>
                <div class="workflow-step">
                    <span id="create-status">‚è≥</span> Create Bill in NetSuite
                    <div id="create-message"></div>
                </div>
            </div>
            
            <div id="workflowMessage"></div>
            <div id="workflowResult"></div>
        </div>
    </div>
    
    <!-- ==================== VENDOR MATCH MODAL (for invoice workflow) ==================== -->
    <div id="vendorMatchModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeVendorModal()">&times;</span>
            <h2>üîç Vendor Matching Required</h2>
            
            <div id="vendorMatchContent">
                <p>This invoice needs to be matched to a vendor before it can be synced to NetSuite.</p>
                
                <div class="vendor-search-section">
                    <h3>Search for Existing Vendor</h3>
                    <input type="text" id="vendorSearch" placeholder="Search vendors..." onkeyup="searchVendorsForMatch(this.value)">
                    <div id="vendorSearchResults"></div>
                </div>
                
                <div class="vendor-create-section">
                    <h3>Or Create New Vendor</h3>
                    <button onclick="showCreateVendorForm()" class="btn btn-secondary">Create New Vendor</button>
                    
                    <div id="createVendorForm" style="display: none;">
                        <input type="text" id="newVendorName" placeholder="Vendor Name">
                        <input type="email" id="newVendorEmail" placeholder="Email">
                        <input type="tel" id="newVendorPhone" placeholder="Phone">
                        <input type="text" id="newVendorTaxId" placeholder="Tax ID">
                        <button onclick="createVendorForInvoice()" class="btn btn-primary">Create Vendor</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Navigation Header -->
    <header class="main-navigation">
        <div class="nav-container">
            <div class="nav-brand">
                <h1 class="brand-title">üßæ Invoice AI</h1>
                <span class="brand-subtitle">4-Layer Hybrid Intelligence</span>
            </div>
            <nav class="nav-tabs">
                <a href="/" class="nav-link active" data-tab="netsuite-dashboard">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="/#invoices" class="nav-link" data-tab="invoices">
                    <span class="nav-icon">üìÑ</span>
                    <span class="nav-text">Invoices</span>
                </a>
                <a href="/#vendors" class="nav-link" data-tab="vendors">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Vendors</span>
                </a>
                <a href="/#matching" class="nav-link" data-tab="matching">
                    <span class="nav-icon">üîó</span>
                    <span class="nav-text">Matching</span>
                </a>
                <a href="/#gmail" class="nav-link" data-tab="gmail">
                    <span class="nav-icon">üìß</span>
                    <span class="nav-text">Gmail</span>
                </a>
                <a href="/#generate" class="nav-link" data-tab="generate">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Generate</span>
                </a>
                <a href="/#api-docs" class="nav-link" data-tab="api-docs">
                    <span class="nav-icon">üîß</span>
                    <span class="nav-text">API</span>
                </a>
                <a href="/#netsuite-events" class="nav-link" data-tab="netsuite-events">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">NetSuite Events</span>
                </a>
            </nav>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <svg class="nav-toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 12h18M3 6h18M3 18h18"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Tab Content Container -->
    <main class="tab-content-container">
        
        <!-- ==================== NETSUITE DASHBOARD TAB (DEFAULT) ==================== -->
        <div class="tab-content active" id="tab-netsuite-dashboard">
            
            <!-- NetSuite Connection Status Bar -->
            <section class="card" id="netsuiteConnectionStatus" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div class="card-body" style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; font-size: 18px; opacity: 0.9;">NetSuite Connection Status</h3>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <span id="connectionStatusBadge" style="display: inline-flex; align-items: center; gap: 8px; font-size: 16px;">
                                    <span id="connectionStatusIcon">‚ö°</span>
                                    <strong id="connectionStatusText">Checking...</strong>
                                </span>
                                <span id="netsuiteAccountInfo" style="opacity: 0.9; font-size: 15px;">
                                    Account ID: <strong id="netsuiteAccountId">--</strong>
                                </span>
                                <span id="netsuiteEnvironment" style="opacity: 0.9; font-size: 15px;">
                                    Environment: <strong id="netsuiteEnv">--</strong>
                                </span>
                                <span id="netsuiteUrl" style="opacity: 0.9; font-size: 15px;">
                                    URL: <strong id="netsuiteBaseUrl">--</strong>
                                </span>
                            </div>
                        </div>
                        <button onclick="testNetSuiteConnection()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">
                            üîå Test Connection
                        </button>
                    </div>
                    <div id="connectionErrorMsg" style="margin-top: 15px; padding: 10px; background: rgba(255,100,100,0.2); border-radius: 4px; display: none;">
                        <span id="connectionErrorText" style="color: #ffcccc;"></span>
                    </div>
                </div>
            </section>
            
            <!-- Dashboard Header with Controls -->
            <section class="card">
                <div class="card-header">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h2 class="card-title">üìä NetSuite Sync Dashboard</h2>
                            <p class="card-desc">Real-time synchronization status and system health</p>
                        </div>
                        <div class="dashboard-controls" style="display: flex; gap: 8px; align-items: center;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoRefreshToggle" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Auto-refresh</span>
                            </label>
                            <button id="refreshDashboardBtn" class="btn btn-secondary">
                                üîÑ Refresh Now
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Statistics Cards Grid -->
            <div class="dashboard-stats-grid">
                <!-- Vendor Sync Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üë•</span>
                        <h3 class="stat-title">Vendor Sync</h3>
                    </div>
                    <div class="stat-body">
                        <div class="stat-value" id="vendorSyncPercent">0%</div>
                        <div class="stat-details">
                            <span class="stat-label">Synced: <span id="vendorsSynced">0</span></span>
                            <span class="stat-label">Not Synced: <span id="vendorsNotSynced">0</span></span>
                            <span class="stat-label">Total: <span id="vendorsTotal">0</span></span>
                        </div>
                        <div class="stat-chart">
                            <canvas id="vendorSyncChart" width="150" height="150"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Sync Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üìÑ</span>
                        <h3 class="stat-title">Invoice Bills</h3>
                    </div>
                    <div class="stat-body">
                        <div class="stat-value" id="invoiceBillPercent">0%</div>
                        <div class="stat-details">
                            <span class="stat-label">With Bills: <span id="invoicesWithBills">0</span></span>
                            <span class="stat-label">Without Bills: <span id="invoicesWithoutBills">0</span></span>
                            <span class="stat-label">Total: <span id="invoicesTotal">0</span></span>
                        </div>
                        <div class="stat-chart">
                            <canvas id="invoiceSyncChart" width="150" height="150"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Status Card -->
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üí∞</span>
                        <h3 class="stat-title">Payment Status</h3>
                    </div>
                    <div class="stat-body">
                        <div class="stat-value" id="paymentsPaidPercent">0%</div>
                        <div class="stat-details">
                            <span class="stat-label status-paid">Paid: <span id="paymentsPaid">0</span></span>
                            <span class="stat-label status-pending">Pending: <span id="paymentsPending">0</span></span>
                            <span class="stat-label status-overdue">Overdue: <span id="paymentsOverdue">0</span></span>
                            <span class="stat-label status-partial">Partial: <span id="paymentsPartial">0</span></span>
                        </div>
                        <div class="stat-chart">
                            <canvas id="paymentStatusChart" width="150" height="150"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ö° Quick Actions</h2>
                    <p class="card-desc">Common synchronization operations</p>
                </div>
                <div class="quick-actions-grid">
                    <button class="action-btn" onclick="pullVendorsFromNetSuite()">
                        <span class="action-icon">‚¨áÔ∏è</span>
                        <span class="action-text">Pull Vendors</span>
                    </button>
                    <button class="action-btn" onclick="syncAllPayments()">
                        <span class="action-icon">üí≥</span>
                        <span class="action-text">Sync Payments</span>
                    </button>
                    <button class="action-btn" onclick="window.location.href='/#vendors'">
                        <span class="action-icon">üë•</span>
                        <span class="action-text">Manage Vendors</span>
                    </button>
                    <button class="action-btn" onclick="window.location.href='/#invoices'">
                        <span class="action-icon">üìÑ</span>
                        <span class="action-text">Process Invoices</span>
                    </button>
                </div>
            </section>
            
            <!-- Recent Activity Feed -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üìú Recent Sync Activities</h2>
                    <p class="card-desc">Last 10 synchronization operations</p>
                </div>
                <div id="activityFeed" class="activity-feed">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading activities...</p>
                    </div>
                </div>
            </section>
            
            <!-- Operation Statistics -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üìà Operation Statistics (Last 24 Hours)</h2>
                    <p class="card-desc">Sync operation performance metrics</p>
                </div>
                <div id="operationStats" class="operation-stats-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading statistics...</p>
                    </div>
                </div>
            </section>
            
        </div>
        
        <!-- ==================== INVOICES TAB ==================== -->
        <div class="tab-content" id="tab-invoices">
            
            <!-- Upload Invoice Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üì§ Upload Invoice</h2>
                    <p class="card-desc">Drag & drop or click to upload</p>
                </div>
                
                <form id="uploadForm">
                    <div class="upload-area" id="uploadArea">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <p class="upload-text">Drag & drop your invoice here or click to browse</p>
                        <p class="upload-hint">PDF, PNG, JPG, TIFF (Max 16MB)</p>
                        <input type="file" id="fileInput" name="file" accept=".pdf,.png,.jpg,.jpeg,.tiff,.gif" hidden>
                    </div>
                    <button type="submit" id="submitBtn" class="btn btn-primary btn-full" disabled>Process Invoice</button>
                </form>
                
                <!-- Invoice Upload Progress -->
                <div id="uploadProgress" class="hidden"></div>
                
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Processing invoice through 4-layer pipeline...</p>
                    <small>Document AI ‚Üí Multi-Currency ‚Üí Vertex Search ‚Üí Gemini</small>
                </div>
                
                <div id="results" class="card hidden">
                    <h3 class="section-title">Extraction Results</h3>
                    <div id="resultContent"></div>
                </div>
            </section>
            
            <!-- Invoice List Section -->
            <section class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <h2 class="card-title">üìã All Invoices</h2>
                    <p class="card-desc">View and manage all processed invoices</p>
                </div>
                
                <!-- Invoice Search & Filters -->
                <div class="search-controls" style="padding: 20px; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <input type="text" 
                               id="invoiceSearchInput" 
                               placeholder="üîç Search invoices by ID, vendor, or amount..." 
                               class="search-input"
                               style="flex: 1; min-width: 300px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        
                        <select id="invoiceStatusFilter" class="filter-select" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                            <option value="">All Status</option>
                            <option value="matched">‚úÖ Matched</option>
                            <option value="unmatched">‚ûï Unmatched</option>
                            <option value="ambiguous">‚ùì Ambiguous</option>
                        </select>
                        
                        <select id="invoiceSyncFilter" class="filter-select" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                            <option value="">All Sync Status</option>
                            <option value="synced">‚úÖ In NetSuite</option>
                            <option value="not_synced">‚è≥ Not in NetSuite</option>
                        </select>
                        
                        <button onclick="searchInvoices()" class="btn btn-primary">
                            Search
                        </button>
                    </div>
                </div>
                
                <!-- Invoice Stats -->
                <div id="invoiceStats" class="stats-grid" style="padding: 20px; display: flex; gap: 15px;">
                    <!-- Stats will be dynamically inserted here -->
                </div>
                
                <!-- Invoice List Container -->
                <div id="invoiceListContainer" style="padding: 20px;">
                    <div id="invoiceLoading" class="loading hidden">
                        <div class="spinner"></div>
                        <p>Loading invoices...</p>
                    </div>
                    
                    <div id="invoiceList">
                        <!-- Invoices will be dynamically inserted here -->
                    </div>
                    
                    <div id="invoiceEmptyState" class="empty-state hidden">
                        <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        <h3 class="empty-title">No invoices yet</h3>
                        <p class="empty-desc">Upload your first invoice above to get started</p>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div id="invoicePagination" class="pagination hidden" style="padding: 20px; border-top: 1px solid #e5e7eb;">
                    <!-- Pagination controls will be dynamically inserted here -->
                </div>
            </section>
            
        </div>
        
        <!-- ==================== VENDORS TAB ==================== -->
        <div class="tab-content" id="tab-vendors">
            
            <!-- NetSuite Vendor Pull Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üîÑ NetSuite Vendor Import</h2>
                    <p class="card-desc">Pull all vendors from NetSuite to BigQuery</p>
                </div>
                
                <div class="netsuite-pull-controls">
                    <button id="pullVendorsBtn" onclick="pullVendorsFromNetSuite()" class="btn btn-primary">
                        <span class="btn-icon">‚¨áÔ∏è</span> Pull Vendors from NetSuite
                    </button>
                    <p class="help-text" style="margin-top: 10px; color: #666;">Import all vendors from NetSuite. New vendors will be added, existing ones will be updated.</p>
                </div>
                
                <!-- Pull Progress Modal -->
                <div id="vendorPullProgress" class="progress-section hidden" style="margin-top: 20px;">
                    <div class="progress-header">
                        <h3>‚è≥ Importing Vendors from NetSuite</h3>
                    </div>
                    <div class="progress-body">
                        <div class="progress-bar" style="background: #f0f0f0; border-radius: 10px; overflow: hidden; height: 30px; margin: 15px 0;">
                            <div id="vendorPullProgressBar" class="progress-fill" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3b82f6, #6366f1); transition: width 0.3s ease;"></div>
                        </div>
                        <div id="vendorPullStatus" class="progress-status" style="font-size: 16px; color: #333; margin: 10px 0;">Initializing...</div>
                        <div id="vendorPullDetails" class="progress-details" style="font-size: 14px; color: #666;"></div>
                    </div>
                </div>
                
                <!-- Pull Results -->
                <div id="vendorPullResults" class="results-section hidden" style="margin-top: 20px; padding: 20px; background: #f9fafb; border-radius: 8px;">
                    <h3>‚úÖ Import Complete</h3>
                    <div id="vendorPullStats" class="stats-grid" style="margin: 15px 0;"></div>
                    <div id="vendorPullErrors" class="error-list" style="margin: 15px 0;"></div>
                    <button onclick="closePullResults()" class="btn btn-secondary">Close</button>
                </div>
            </section>
            
            <!-- CSV Import Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Import Vendor CSV</h2>
                    <p class="card-desc">AI auto-maps columns in 40+ languages</p>
                </div>
                
                <form id="csvUploadForm">
                    <div class="upload-area" id="csvUploadArea">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        <p class="upload-text">Drag & drop your vendor CSV here or click to browse</p>
                        <p class="upload-hint">SAP, Oracle, QuickBooks, Excel formats</p>
                        <input type="file" id="csvFileInput" name="file" accept=".csv,.txt" hidden>
                    </div>
                    <button type="submit" id="csvSubmitBtn" class="btn btn-primary btn-full" disabled>üß† Analyze CSV with AI</button>
                </form>
                
                <div id="csvLoading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>AI analyzing CSV headers and schema...</p>
                    <small>Gemini 2.0 Flash - Chain of Thought Mapping</small>
                </div>
                
                <!-- Step 2: Review AI Mapping -->
                <div id="csvMappingReview" class="card hidden">
                    <h3 class="section-title">üß† AI Column Mapping - Review & Confirm</h3>
                    <div id="csvMappingContent"></div>
                    <div class="button-group">
                        <button id="csvImportBtn" class="btn btn-primary">
                            ‚úÖ Confirm & Import to BigQuery
                        </button>
                        <button id="csvCancelBtn" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </div>
                
                <!-- CSV Import Progress -->
                <div id="csvImportProgress" class="hidden"></div>
                
                <!-- Import Results -->
                <div id="csvImportResults" class="card hidden"></div>
            </section>
            
            <!-- Vendor Database Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Vendor Database</h2>
                    <p class="card-desc">Browse all vendors from BigQuery</p>
                </div>
                
                <!-- Search Bar -->
                <div class="search-box">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                    <input 
                        type="text" 
                        id="vendorSearchInput" 
                        placeholder="Search vendors by name..." 
                        class="search-input">
                </div>
                
                <!-- Stats Bar -->
                <div id="vendorStats" class="stats-grid"></div>
                
                <!-- Loading State -->
                <div id="vendorLoading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Loading vendors from BigQuery...</p>
                </div>
                
                <!-- Empty State -->
                <div id="vendorEmptyState" class="empty-state hidden">
                    <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <h3 class="empty-title">No vendors found</h3>
                    <p class="empty-desc">Upload a vendor CSV to get started</p>
                </div>
                
                <!-- Vendor List Container -->
                <div id="vendorListContainer"></div>
                
                <!-- Pagination Controls -->
                <div id="vendorPagination" class="pagination hidden">
                    <button id="vendorPrevBtn" class="btn btn-secondary">
                        ‚Üê Previous
                    </button>
                    <div id="vendorPageInfo" class="page-info"></div>
                    <button id="vendorNextBtn" class="btn btn-secondary">
                        Next ‚Üí
                    </button>
                </div>
            </section>
            
        </div>
        
        <!-- ==================== MATCHING TAB ==================== -->
        <div class="tab-content" id="tab-matching">
            
            <!-- Invoice Match History Section -->
            <section class="card">
                <div class="card-header">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h2 class="card-title">üìã Invoice-Vendor Match History</h2>
                            <p class="card-desc">View all invoices and their vendor matches</p>
                        </div>
                        <button id="refreshInvoicesBtn" class="btn btn-secondary">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Filter and Controls -->
                <div class="invoice-filters">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="invoiceStatusFilter" class="form-label">Filter by Status:</label>
                        <select id="invoiceStatusFilter" class="form-select">
                            <option value="">All Invoices</option>
                            <option value="matched">‚úì Matched</option>
                            <option value="unmatched">+ New Vendor</option>
                            <option value="ambiguous">? Ambiguous</option>
                        </select>
                    </div>
                </div>
                
                <!-- Invoice List -->
                <div id="invoiceMatchList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading invoices...</p>
                    </div>
                </div>
                
                <!-- Pagination Controls -->
                <div id="invoicePagination" class="pagination-controls hidden"></div>
            </section>
            
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">‚öñÔ∏è Vendor Matching Engine</h2>
                    <p class="card-desc">Test the Supreme Judge AI</p>
                </div>
                
                <form id="vendorMatchForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="matchVendorName" class="form-label">
                                Vendor Name <span class="required">*</span>
                            </label>
                            <input type="text" id="matchVendorName" class="form-input" placeholder="e.g., Amazon AWS" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="matchTaxId" class="form-label">Tax ID / VAT</label>
                            <input type="text" id="matchTaxId" class="form-input" placeholder="e.g., US123456789">
                        </div>
                        
                        <div class="form-group">
                            <label for="matchEmailDomain" class="form-label">Email Domain</label>
                            <input type="text" id="matchEmailDomain" class="form-input" placeholder="e.g., @aws.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="matchCountry" class="form-label">Country</label>
                            <input type="text" id="matchCountry" class="form-input" placeholder="e.g., US, IL, GB">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="matchAddress" class="form-label">Address</label>
                        <input type="text" id="matchAddress" class="form-input" placeholder="e.g., 410 Terry Ave N, Seattle, WA">
                    </div>
                    
                    <div class="form-group">
                        <label for="matchPhone" class="form-label">Phone</label>
                        <input type="text" id="matchPhone" class="form-input" placeholder="e.g., +1-206-555-0100">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-full btn-lg">
                        üîç Match Vendor with Supreme Judge AI
                    </button>
                </form>
                
                <!-- Vendor Matching Progress -->
                <div id="vendorMatchProgress" class="hidden"></div>
                
                <div id="matchLoading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>The Supreme Judge is analyzing vendor match...</p>
                    <small>3-Step Pipeline: Tax ID ‚Üí Semantic Search ‚Üí Gemini Reasoning</small>
                </div>
                
                <div id="matchResults" class="card hidden"></div>
            </section>
            
        </div>
        
        <!-- ==================== GMAIL TAB ==================== -->
        <div class="tab-content" id="tab-gmail">
            
            <!-- Gmail Import Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üìß Import from Gmail</h2>
                    <p class="card-desc">Automatically scan and import invoices from your Gmail inbox</p>
                </div>
                
                <div id="gmailStatus" class="status-banner"></div>
                
                <div id="gmailConnectSection">
                    <button id="gmailConnectBtn" class="btn btn-primary btn-full">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        Connect Gmail
                    </button>
                </div>
                
                <div id="gmailImportSection" class="hidden">
                    <div class="form-group">
                        <label for="gmailTimeRange" class="form-label">‚è∞ Scan emails from:</label>
                        <select id="gmailTimeRange" class="form-select">
                            <option value="1">Last 24 hours</option>
                            <option value="7" selected>Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="60">Last 60 days</option>
                            <option value="90">Last 90 days</option>
                            <option value="180">Last 6 months</option>
                            <option value="365">Last year</option>
                            <option value="9999">All time</option>
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button id="gmailImportBtn" class="btn btn-primary">
                            üîç Start Smart Scan
                        </button>
                        <button id="gmailDisconnectBtn" class="btn btn-secondary">
                            Disconnect
                        </button>
                    </div>
                    
                    <!-- Real-time Progress Terminal -->
                    <div id="gmailProgressTerminal" class="hidden terminal-window">
                        <div class="terminal-header">
                            <div class="terminal-title">üìß Gmail Invoice Scanner - Live Progress</div>
                            <button id="minimizeTerminal" class="terminal-minimize">Minimize</button>
                        </div>
                        <div class="terminal-body" id="terminalOutput"></div>
                    </div>
                    
                    <div id="gmailImportResults"></div>
                    
                    <!-- Import History -->
                    <div id="gmailImportHistory" class="hidden">
                        <h3 class="section-title">üìú Import History</h3>
                        <div id="historyList"></div>
                    </div>
                </div>
            </section>
            
        </div>
        
        <!-- ==================== API DOCS TAB ==================== -->
        <div class="tab-content" id="tab-api-docs">
            
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">üîå LangSmith Agent API</h2>
                    <p class="card-desc">Programmatic access for AI agents</p>
                </div>
                
                <div class="api-docs-content">
                    
                    <!-- API Key Generation -->
                    <div class="api-section">
                        <h3 class="api-section-title">üîë Authentication</h3>
                        <p class="api-desc">Generate an API key to authenticate your LangSmith agents. Include it in the <code>X-API-Key</code> header for all requests.</p>
                        
                        <div class="api-key-generator">
                            <div class="form-group">
                                <label for="apiClientId" class="form-label">Client ID <span class="required">*</span></label>
                                <input type="text" id="apiClientId" class="form-input" placeholder="e.g., acme_corp_001" required>
                            </div>
                            <div class="form-group">
                                <label for="apiKeyDescription" class="form-label">Description (optional)</label>
                                <input type="text" id="apiKeyDescription" class="form-input" placeholder="e.g., Production LangSmith Agent">
                            </div>
                            <button id="generateApiKeyBtn" class="btn btn-primary">
                                ‚ö° Generate API Key
                            </button>
                        </div>
                        
                        <div id="apiKeyResult" class="hidden api-key-result">
                            <div class="alert alert-success">
                                <strong>‚úÖ API Key Generated Successfully!</strong>
                                <p class="api-key-warning">‚ö†Ô∏è Save this key now - it won't be shown again!</p>
                            </div>
                            <div class="api-key-display">
                                <code id="generatedApiKey" class="api-key-value"></code>
                                <button id="copyApiKeyBtn" class="btn btn-secondary btn-sm">üìã Copy</button>
                            </div>
                            <div class="api-key-details">
                                <p><strong>Client ID:</strong> <span id="apiKeyClientId"></span></p>
                                <p><strong>Created:</strong> <span id="apiKeyCreated"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Authentication Example -->
                    <div class="api-section">
                        <h3 class="api-section-title">üì° Using Your API Key</h3>
                        <pre class="code-block"><code>curl -X GET "https://your-app.repl.co/api/agent/test" \
  -H "X-API-Key: sk_your_api_key_here"

# Or use Authorization header
curl -X GET "https://your-app.repl.co/api/agent/test" \
  -H "Authorization: Bearer sk_your_api_key_here"</code></pre>
                    </div>
                    
                    <!-- Endpoints Documentation -->
                    <div class="api-section">
                        <h3 class="api-section-title">üìö API Endpoints (12 Total)</h3>
                        
                        <!-- Search -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/search</span>
                            </div>
                            <p class="endpoint-desc">Search across all vendors, invoices, and documents</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X POST "https://your-app.repl.co/api/agent/search" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Amazon",
    "page": 1,
    "max_results": 50
  }'

# Response:
{
  "success": true,
  "results": [
    {
      "type": "vendor",
      "vendor_id": "V123",
      "vendor_name": "Amazon Web Services",
      "score": 0.95,
      "source": "vertex_search",
      "metadata": {...}
    }
  ],
  "total_count": 42,
  "page": 1,
  "has_more": false
}</code></pre>
                            </details>
                        </div>
                        
                        <!-- Get Vendor Details -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method get">GET</span>
                                <span class="endpoint-path">/api/agent/vendor/{vendor_id}</span>
                            </div>
                            <p class="endpoint-desc">Get detailed vendor information with invoice statistics</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X GET "https://your-app.repl.co/api/agent/vendor/V123" \
  -H "X-API-Key: sk_..."

# Response:
{
  "vendor_id": "V123",
  "global_name": "Amazon Web Services",
  "emails": ["aws@amazon.com"],
  "countries": ["US"],
  "invoice_count": 156,
  "total_spend": 45678.90,
  "last_invoice_date": "2025-11-15"
}</code></pre>
                            </details>
                        </div>
                        
                        <!-- Get Invoice Details -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method get">GET</span>
                                <span class="endpoint-path">/api/agent/invoice/{invoice_id}</span>
                            </div>
                            <p class="endpoint-desc">Get complete invoice extraction data</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X GET "https://your-app.repl.co/api/agent/invoice/INV-2025-001" \
  -H "X-API-Key: sk_..."</code></pre>
                            </details>
                        </div>
                        
                        <!-- Client Summary -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method get">GET</span>
                                <span class="endpoint-path">/api/agent/client/{client_id}/summary</span>
                            </div>
                            <p class="endpoint-desc">Get client dashboard with statistics</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X GET "https://your-app.repl.co/api/agent/client/acme_corp/summary" \
  -H "X-API-Key: sk_..."

# Response:
{
  "client_id": "acme_corp",
  "total_vendors": 234,
  "total_invoices": 1567,
  "pending_invoices": 12,
  "compliance_issues": 3,
  "last_sync": "2025-11-22T20:00:00Z"
}</code></pre>
                            </details>
                        </div>
                        
                        <!-- Get Issues -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method get">GET</span>
                                <span class="endpoint-path">/api/agent/issues</span>
                            </div>
                            <p class="endpoint-desc">List all compliance issues (missing W-9s, duplicates)</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X GET "https://your-app.repl.co/api/agent/issues?severity=high,medium" \
  -H "X-API-Key: sk_..."

# Response:
{
  "issues": [
    {
      "issue_id": "ISS-ABC123",
      "type": "missing_w9",
      "severity": "high",
      "vendor_name": "ACME Corp",
      "vendor_email": "billing@acme.com",
      "description": "Vendor has 23 invoices totaling $45,678 but no W-9 on file"
    }
  ]
}</code></pre>
                            </details>
                        </div>
                        
                        <!-- Resolve Issue -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/issues/{issue_id}/resolve</span>
                            </div>
                            <p class="endpoint-desc">Mark an issue as resolved</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X POST "https://your-app.repl.co/api/agent/issues/ISS-ABC123/resolve" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{"resolution": "W-9 received via email"}'</code></pre>
                            </details>
                        </div>
                        
                        <!-- Send Vendor Email -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/vendor/send-email</span>
                            </div>
                            <p class="endpoint-desc">Send automated email to a vendor</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X POST "https://your-app.repl.co/api/agent/vendor/send-email" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "vendor_id": "V123",
    "to": "billing@vendor.com",
    "subject": "W-9 Form Required",
    "body": "Dear vendor, we need your W-9...",
    "track_as_issue": "ISS-ABC123"
  }'</code></pre>
                            </details>
                        </div>
                        
                        <!-- Send Client Notification -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/client/notify</span>
                            </div>
                            <p class="endpoint-desc">Send notification to client</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X POST "https://your-app.repl.co/api/agent/client/notify" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "to": "finance@client.com",
    "subject": "3 Compliance Issues Detected",
    "body": "Summary of issues..."
  }'</code></pre>
                            </details>
                        </div>
                        
                        <!-- Create Action -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/actions/create</span>
                            </div>
                            <p class="endpoint-desc">Create a pending action for human approval</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X POST "https://your-app.repl.co/api/agent/actions/create" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "action_type": "send_vendor_email",
    "vendor_id": "V123",
    "vendor_email": "vendor@example.com",
    "issue_id": "ISS-ABC123",
    "priority": "high",
    "suggested_email": {
      "subject": "W-9 Required",
      "body": "We need your W-9 form..."
    }
  }'

# Response:
{
  "success": true,
  "action_id": "ACT-XYZ789",
  "status": "pending_approval"
}</code></pre>
                            </details>
                        </div>
                        
                        <!-- Get Pending Actions -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method get">GET</span>
                                <span class="endpoint-path">/api/agent/actions/pending</span>
                            </div>
                            <p class="endpoint-desc">Get all pending actions for approval</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X GET "https://your-app.repl.co/api/agent/actions/pending" \
  -H "X-API-Key: sk_..."

# Response:
{
  "pending_actions": [
    {
      "action_id": "ACT-XYZ789",
      "action_type": "send_vendor_email",
      "priority": "high",
      "vendor_email": "vendor@example.com",
      "email_subject": "W-9 Required",
      "created_at": "2025-11-22T19:30:00Z"
    }
  ]
}</code></pre>
                            </details>
                        </div>
                        
                        <!-- Approve Action -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/actions/{action_id}/approve</span>
                            </div>
                            <p class="endpoint-desc">Approve or reject a pending action</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code># Approve and send
curl -X POST "https://your-app.repl.co/api/agent/actions/ACT-XYZ789/approve" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "approved": true,
    "modified_email": {
      "subject": "Updated subject",
      "body": "Modified email body..."
    }
  }'

# Reject
curl -X POST "https://your-app.repl.co/api/agent/actions/ACT-XYZ789/approve" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{"approved": false}'</code></pre>
                            </details>
                        </div>
                        
                        <!-- Update Settings -->
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="http-method post">POST</span>
                                <span class="endpoint-path">/api/agent/client/{client_id}/settings</span>
                            </div>
                            <p class="endpoint-desc">Update client automation settings</p>
                            <details class="endpoint-details">
                                <summary>View Example ‚Üí</summary>
                                <pre class="code-block"><code>curl -X POST "https://your-app.repl.co/api/agent/client/acme_corp/settings" \
  -H "X-API-Key: sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "auto_send_vendor_emails": true,
    "auto_send_threshold": "high_priority_only"
  }'</code></pre>
                            </details>
                        </div>
                        
                    </div>
                    
                    <!-- Security Notes -->
                    <div class="api-section">
                        <h3 class="api-section-title">üîí Security</h3>
                        <ul class="api-security-list">
                            <li><strong>Tenant Isolation:</strong> API keys are scoped to a single client_id. You can only access your own data.</li>
                            <li><strong>API Key Storage:</strong> Keys are hashed with bcrypt. The raw key is only shown once during generation.</li>
                            <li><strong>Rate Limiting:</strong> Coming soon - implement rate limiting in your application if needed.</li>
                            <li><strong>HTTPS Only:</strong> Always use HTTPS in production to protect API keys in transit.</li>
                        </ul>
                    </div>
                    
                    <!-- Quick Start -->
                    <div class="api-section">
                        <h3 class="api-section-title">üöÄ Quick Start for LangSmith</h3>
                        <ol class="api-quickstart">
                            <li>Generate an API key above using your client_id</li>
                            <li>Copy the key and store it securely (e.g., environment variable)</li>
                            <li>Configure your LangSmith agent to include the API key in requests</li>
                            <li>Start with <code>/api/agent/search</code> to explore your data</li>
                            <li>Use <code>/api/agent/issues</code> to detect compliance problems</li>
                            <li>Create actions with <code>/api/agent/actions/create</code> for human approval</li>
                        </ol>
                    </div>
                    
                </div>
            </section>
            
        </div>
        
        <!-- ==================== GENERATE INVOICE TAB ==================== -->
        <div class="tab-content" id="tab-generate">
            
            <!-- Mode Selection Card -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="inline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="12" y1="8" x2="12" y2="16"></line>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                        Create Professional Invoice
                    </h2>
                    <p class="card-desc">Generate beautiful PDF invoices with AI assistance</p>
                </div>
                
                <div class="invoice-mode-selector">
                    <div class="mode-card active" data-mode="simple">
                        <div class="mode-icon">‚ú®</div>
                        <h3>Simple Mode</h3>
                        <p>Quick invoice with basic details</p>
                    </div>
                    <div class="mode-card" data-mode="advanced">
                        <div class="mode-icon">‚öôÔ∏è</div>
                        <h3>Advanced Mode</h3>
                        <p>Full control with line items</p>
                    </div>
                </div>
            </section>
            
            <!-- Simple Mode Form -->
            <section class="card invoice-mode" id="simple-mode">
                <div class="card-header">
                    <h3 class="card-subtitle">
                        <svg class="inline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="13 2 13 8 20 8"></polyline>
                        </svg>
                        Quick Invoice Generation
                    </h3>
                    <button type="button" id="fillTestDataSimple" class="btn-test-data">
                        üé≤ Fill with Test Data
                    </button>
                </div>
                
                <form id="simpleInvoiceForm">
                    <!-- Vendor Selection -->
                    <div class="form-group">
                        <label for="vendorSearch" class="form-label">
                            <span>üè¢ Vendor</span>
                            <span class="required">*</span>
                        </label>
                        <input type="text" 
                               id="vendorSearch" 
                               class="form-input vendor-autocomplete" 
                               placeholder="Type to search vendors..."
                               autocomplete="off"
                               required>
                        <div id="vendorSuggestions" class="autocomplete-suggestions hidden"></div>
                        <input type="hidden" id="selectedVendorId">
                    </div>
                    
                    <!-- Description with Magic Fill -->
                    <div class="form-group">
                        <label for="invoiceDescription" class="form-label">
                            <span>üìù What for?</span>
                            <span class="required">*</span>
                        </label>
                        <div class="magic-fill-container">
                            <textarea id="invoiceDescription" 
                                     class="form-textarea" 
                                     placeholder="E.g., '5 hours consulting at $100/hour' or 'Website development for $5000'"
                                     rows="3"
                                     required></textarea>
                            <button type="button" id="magicFillBtn" class="magic-fill-btn" title="AI Magic Fill">
                                ü™Ñ Magic Fill
                            </button>
                        </div>
                        <p class="form-hint">Describe the service/product naturally - AI will understand!</p>
                    </div>
                    
                    <!-- Amount -->
                    <div class="form-group">
                        <label for="invoiceAmount" class="form-label">
                            <span>üí∞ Amount</span>
                            <span class="required">*</span>
                        </label>
                        <div class="amount-input-group">
                            <select id="invoiceCurrency" class="form-select currency-select">
                                <option value="USD">USD ($)</option>
                                <option value="EUR">EUR (‚Ç¨)</option>
                                <option value="GBP">GBP (¬£)</option>
                                <option value="ILS">ILS (‚Ç™)</option>
                                <option value="CAD">CAD (C$)</option>
                                <option value="AUD">AUD (A$)</option>
                                <option value="JPY">JPY (¬•)</option>
                                <option value="INR">INR (‚Çπ)</option>
                            </select>
                            <input type="number" 
                                   id="invoiceAmount" 
                                   class="form-input amount-input" 
                                   placeholder="0.00"
                                   step="0.01"
                                   min="0"
                                   required>
                        </div>
                    </div>
                    
                    <!-- Tax Type -->
                    <div class="form-group">
                        <label for="taxType" class="form-label">üèõÔ∏è Tax Type</label>
                        <select id="taxType" class="form-select">
                            <option value="auto">Auto-detect (Based on vendor)</option>
                            <option value="none">None</option>
                            <option value="vat">VAT</option>
                            <option value="sales">Sales Tax</option>
                            <option value="gst">GST</option>
                        </select>
                    </div>
                    
                    <!-- Buyer Information -->
                    <div class="form-group">
                        <label for="buyerName" class="form-label">
                            <span>üè™ Bill To (Your Company)</span>
                            <span class="required">*</span>
                        </label>
                        <input type="text" 
                               id="buyerName" 
                               class="form-input" 
                               placeholder="Your company name"
                               required>
                    </div>
                    
                    <!-- Generate Button -->
                    <div class="form-actions">
                        <button type="button" id="validateInvoiceBtn" class="btn btn-secondary">
                            ‚úÖ Validate
                        </button>
                        <button type="submit" id="generateSimpleInvoiceBtn" class="btn btn-primary">
                            üöÄ Generate Invoice
                        </button>
                    </div>
                </form>
                
                <!-- Validation Results -->
                <div id="validationResults" class="validation-results hidden"></div>
            </section>
            
            <!-- Advanced Mode Form -->
            <section class="card invoice-mode hidden" id="advanced-mode">
                <div class="card-header">
                    <h3 class="card-subtitle">
                        <svg class="inline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <path d="M14 2l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8z"/>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        Enterprise Invoice Builder
                    </h3>
                    <button type="button" id="fillTestDataAdvanced" class="btn-test-data">
                        üé≤ Fill with Test Data
                    </button>
                </div>
                
                <form id="advancedInvoiceForm">
                    <!-- Invoice Details Row -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="invoiceNumber" class="form-label">Invoice Number</label>
                            <input type="text" 
                                   id="invoiceNumber" 
                                   class="form-input" 
                                   placeholder="AUTO_GEN_XXXXXX">
                        </div>
                        <div class="form-group">
                            <label for="poNumber" class="form-label">PO Number</label>
                            <input type="text" 
                                   id="poNumber" 
                                   class="form-input" 
                                   placeholder="Optional">
                        </div>
                    </div>
                    
                    <!-- Date Row -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="issueDate" class="form-label">
                                <span>Issue Date</span>
                                <span class="required">*</span>
                            </label>
                            <input type="date" 
                                   id="issueDate" 
                                   class="form-input" 
                                   required>
                        </div>
                        <div class="form-group">
                            <label for="dueDate" class="form-label">
                                <span>Due Date</span>
                                <span class="required">*</span>
                            </label>
                            <input type="date" 
                                   id="dueDate" 
                                   class="form-input" 
                                   required>
                        </div>
                    </div>
                    
                    <!-- Vendor Selection (Advanced) -->
                    <div class="form-group">
                        <label for="vendorSearchAdv" class="form-label">
                            <span>üè¢ Vendor</span>
                            <span class="required">*</span>
                        </label>
                        <input type="text" 
                               id="vendorSearchAdv" 
                               class="form-input vendor-autocomplete" 
                               placeholder="Type to search vendors..."
                               autocomplete="off"
                               required>
                        <div id="vendorSuggestionsAdv" class="autocomplete-suggestions hidden"></div>
                        <input type="hidden" id="selectedVendorIdAdv">
                    </div>
                    
                    <!-- Buyer Details -->
                    <fieldset class="form-fieldset">
                        <legend>Bill To Information</legend>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="buyerNameAdv" class="form-label">
                                    <span>Company Name</span>
                                    <span class="required">*</span>
                                </label>
                                <input type="text" 
                                       id="buyerNameAdv" 
                                       class="form-input" 
                                       required>
                            </div>
                            <div class="form-group">
                                <label for="buyerTaxId" class="form-label">Tax ID</label>
                                <input type="text" 
                                       id="buyerTaxId" 
                                       class="form-input">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="buyerAddress" class="form-label">Address</label>
                                <input type="text" 
                                       id="buyerAddress" 
                                       class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="buyerCountry" class="form-label">Country</label>
                                <input type="text" 
                                       id="buyerCountry" 
                                       class="form-input">
                            </div>
                        </div>
                    </fieldset>
                    
                    <!-- Line Items -->
                    <fieldset class="form-fieldset">
                        <legend>Line Items</legend>
                        
                        <!-- Line Items Table -->
                        <div class="line-items-container">
                            <table class="line-items-table">
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th>Qty</th>
                                        <th>Unit Price</th>
                                        <th>Discount %</th>
                                        <th>Tax %</th>
                                        <th>Category</th>
                                        <th>Total</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="lineItemsBody">
                                    <!-- Dynamic rows will be added here -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="8">
                                            <button type="button" id="addLineItemBtn" class="btn btn-secondary btn-sm">
                                                ‚ûï Add Line Item
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </fieldset>
                    
                    <!-- Currency and Exchange Rate -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="invoiceCurrencyAdv" class="form-label">Currency</label>
                            <select id="invoiceCurrencyAdv" class="form-select">
                                <option value="USD">USD ($)</option>
                                <option value="EUR">EUR (‚Ç¨)</option>
                                <option value="GBP">GBP (¬£)</option>
                                <option value="ILS">ILS (‚Ç™)</option>
                                <option value="CAD">CAD (C$)</option>
                                <option value="AUD">AUD (A$)</option>
                                <option value="JPY">JPY (¬•)</option>
                                <option value="INR">INR (‚Çπ)</option>
                                <option value="CNY">CNY (¬•)</option>
                                <option value="CHF">CHF</option>
                                <option value="SEK">SEK (kr)</option>
                                <option value="NOK">NOK (kr)</option>
                                <option value="DKK">DKK (kr)</option>
                                <option value="MXN">MXN ($)</option>
                                <option value="BRL">BRL (R$)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exchangeRate" class="form-label">Exchange Rate</label>
                            <input type="number" 
                                   id="exchangeRate" 
                                   class="form-input" 
                                   placeholder="1.00"
                                   step="0.0001"
                                   value="1">
                        </div>
                    </div>
                    
                    <!-- Payment Terms and Notes -->
                    <div class="form-group">
                        <label for="paymentTerms" class="form-label">Payment Terms</label>
                        <select id="paymentTerms" class="form-select">
                            <option value="Net 30">Net 30</option>
                            <option value="Net 15">Net 15</option>
                            <option value="Net 60">Net 60</option>
                            <option value="Due on Receipt">Due on Receipt</option>
                            <option value="Custom">Custom</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="invoiceNotes" class="form-label">Notes</label>
                        <textarea id="invoiceNotes" 
                                 class="form-textarea" 
                                 placeholder="Additional notes or instructions..."
                                 rows="3"></textarea>
                    </div>
                    
                    <!-- Totals Display -->
                    <div class="invoice-totals">
                        <div class="total-row">
                            <span class="total-label">Subtotal:</span>
                            <span class="total-value" id="subtotalDisplay">$0.00</span>
                        </div>
                        <div class="total-row">
                            <span class="total-label">Discount:</span>
                            <span class="total-value" id="discountDisplay">$0.00</span>
                        </div>
                        <div class="total-row">
                            <span class="total-label">Tax:</span>
                            <span class="total-value" id="taxDisplay">$0.00</span>
                        </div>
                        <div class="total-row total-final">
                            <span class="total-label">Total:</span>
                            <span class="total-value" id="grandTotalDisplay">$0.00</span>
                        </div>
                    </div>
                    
                    <!-- Generate Button (Advanced) -->
                    <div class="form-actions">
                        <button type="button" id="validateAdvancedBtn" class="btn btn-secondary">
                            ‚úÖ Validate
                        </button>
                        <button type="submit" id="generateAdvancedInvoiceBtn" class="btn btn-primary">
                            üöÄ Generate Invoice
                        </button>
                    </div>
                </form>
                
                <!-- Validation Results (Advanced) -->
                <div id="validationResultsAdv" class="validation-results hidden"></div>
            </section>
            
            <!-- Generation Results Section -->
            <section class="card hidden" id="generation-results">
                <div class="card-header">
                    <h3 class="card-subtitle">
                        <svg class="inline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11l3 3L22 4"></path>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        Invoice Generated Successfully
                    </h3>
                </div>
                
                <div class="generation-success">
                    <div class="success-icon">‚úÖ</div>
                    <h2>Your Invoice is Ready!</h2>
                    
                    <div class="invoice-info-grid">
                        <div class="info-item">
                            <span class="info-label">Invoice Number:</span>
                            <span class="info-value" id="result-invoice-number">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Amount:</span>
                            <span class="info-value" id="result-amount">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Vendor:</span>
                            <span class="info-value" id="result-vendor">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span class="status-badge status-success">Generated</span>
                        </div>
                    </div>
                    
                    <div class="storage-info">
                        <div class="storage-item">
                            <svg class="inline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            <div>
                                <strong>Saved to GCS:</strong>
                                <code id="result-gcs-uri">-</code>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <a href="#" id="downloadPdfBtn" class="btn btn-primary" download>
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Download PDF
                        </a>
                        <button type="button" id="generateAnotherBtn" class="btn btn-secondary">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Generate Another
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Generation Progress Section -->
            <section class="card hidden" id="generation-progress">
                <div class="card-header">
                    <h3 class="card-subtitle">
                        <svg class="inline-icon rotating" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M16 12l-4-4-4 4"></path>
                        </svg>
                        Generating Invoice...
                    </h3>
                </div>
                
                <div class="generation-steps">
                    <div class="step-item" id="step-validate">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Validating invoice data...</span>
                    </div>
                    <div class="step-item" id="step-generate">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Generating PDF document...</span>
                    </div>
                    <div class="step-item" id="step-upload">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Uploading to Google Cloud Storage...</span>
                    </div>
                    <div class="step-item" id="step-save">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Saving to database...</span>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="generation-progress-bar" style="width: 0%"></div>
                </div>
            </section>
            
        </div>
        
        <!-- ==================== NETSUITE EVENTS TAB ==================== -->
        <div class="tab-content" id="tab-netsuite-events">
            <section class="card" style="padding: 0; height: calc(100vh - 100px);">
                <iframe 
                    src="/api/netsuite/events/dashboard" 
                    style="width: 100%; height: 100%; border: none; border-radius: 8px;"
                    title="NetSuite Events Dashboard">
                </iframe>
            </section>
        </div>
        
    </main>

    <script src="/static/script.js?v=9"></script>
    <script src="/static/invoice_workflow.js?v=1"></script>
</body>
</html>
